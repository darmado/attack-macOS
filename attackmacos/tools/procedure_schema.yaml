#
# ATT&CK Procedure Template Schema
# This schema defines the structure of procedure templates
#
---
$schema: "http://json-schema.org/draft-07/schema#"
title: "MITRE ATT&CK Procedure Template"
description: "Schema for ATT&CK procedure implementation templates"
type: "object"
required:
  - "procedure"
  - "global_flag"
  - "argument_parser"
  - "main_execution"
  - "help_text"
  - "placeholders"

properties:
  procedure:
    type: "object"
    description: "Details about the ATT&CK procedure being implemented"
    required:
      - "name"
      - "purpose"
      - "mitre_attack"
      - "reference"
      - "code"
    properties:
      name:
        type: "string"
        description: "Name of the procedure function (should start with TTP_ID)"
        pattern: "^T\\d{4}(_[a-z][a-z0-9_]+)+$"
      
      purpose:
        type: "string"
        description: "Brief description of what the procedure does"
      
      mitre_attack:
        type: "object"
        description: "MITRE ATT&CK framework references"
        required:
          - "ttp_id"
          - "tactic"
        properties:
          ttp_id:
            type: "string"
            description: "MITRE ATT&CK Technique ID"
            pattern: "^T\\d{4}(\\.\\d{3})?$"
          
          tactic:
            type: "string"
            description: "MITRE ATT&CK Tactic name"
            enum:
              - "Reconnaissance"
              - "Resource Development"
              - "Initial Access"
              - "Execution"
              - "Persistence"
              - "Privilege Escalation"
              - "Defense Evasion"
              - "Credential Access"
              - "Discovery"
              - "Lateral Movement"
              - "Collection"
              - "Command and Control"
              - "Exfiltration"
              - "Impact"
          
          subtechnique_id:
            type: "string"
            description: "Optional subtechnique ID"
            pattern: "^(T\\d{4}\\.\\d{3})?$"
      
      reference:
        type: "string"
        description: "Source of the procedure information"
      
      code:
        type: "string"
        description: "The shell function code that implements the ATT&CK procedure"

  global_flag:
    type: "object"
    description: "Global flag variable to control procedure execution"
    required:
      - "name"
      - "default_value"
      - "comment"
    properties:
      name:
        type: "string"
        description: "Name of the global flag variable"
        pattern: "^[A-Z][A-Z0-9_]+$"
      
      default_value:
        type: "boolean"
        description: "Default value for the flag (typically false)"
      
      comment:
        type: "string"
        description: "Comment explaining the flag's purpose"

  argument_parser:
    type: "object"
    description: "Command-line argument parsing for the procedure"
    required:
      - "option"
      - "description"
      - "code"
    properties:
      option:
        type: "string"
        description: "Command-line option (e.g., --list-users)"
        pattern: "^--[a-z][a-z0-9-]+$"
      
      description:
        type: "string"
        description: "Brief description of what the option does"
      
      code:
        type: "string"
        description: "Shell code for argument parsing case statement"

  main_execution:
    type: "object"
    description: "Main execution logic for the procedure"
    required:
      - "data_source"
      - "code"
    properties:
      data_source:
        type: "string"
        description: "Identifier for the data source in JSON output"
        pattern: "^[a-z][a-z0-9_]+$"
      
      code:
        type: "string"
        description: "Shell code for executing the procedure in core_main"

  help_text:
    type: "object"
    description: "Help text for the procedure option"
    required:
      - "section"
      - "code"
    properties:
      section:
        type: "string"
        description: "Section name for grouping in help text"
      
      code:
        type: "string"
        description: "Shell code for the help text entry"

  placeholders:
    type: "object"
    description: "Placeholder markers for script integration"
    required:
      - "flag_variable"
      - "argument_parser"
      - "main_execution"
      - "help_text"
    properties:
      flag_variable:
        type: "string"
        description: "Placeholder for flag variable insertion"
      
      argument_parser:
        type: "string"
        description: "Placeholder for argument parser code insertion"
      
      main_execution:
        type: "string"
        description: "Placeholder for main execution code insertion"
      
      help_text:
        type: "string"
        description: "Placeholder for help text insertion"

  example_usage:
    type: "array"
    description: "Example commands for using the procedure"
    items:
      type: "object"
      required:
        - "command"
        - "description"
      properties:
        command:
          type: "string"
          description: "Example command line"
        
        description:
          type: "string"
          description: "Description of what the example demonstrates" 